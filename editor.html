<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <title>Editor Paneli</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="assets/style.css" />
</head>
<body>

<!-- ðŸ” Firebase Auth KontrolÃ¼ -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js";
  import { getAuth, onAuthStateChanged, signOut } 
    from "https://www.gstatic.com/firebasejs/10.7.0/firebase-auth.js";

  const firebaseConfig = {
    apiKey: "AIzaSyD_0Y9D2ljwwC7pHmaYTrbwc677kwIUrgQ",
    authDomain: "isahalis.firebaseapp.com",
    projectId: "isahalis",
    storageBucket: "isahalis.firebasestorage.app",
    messagingSenderId: "33060832531",
    appId: "1:33060832531:web:31cdc1598686be16aa06e6",
    measurementId: "G-2N25T885EH"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);

  // KullanÄ±cÄ± giriÅŸ yapmamÄ±ÅŸsa login'e at
  onAuthStateChanged(auth, (user) => {
    if (!user) {
      console.log("KullanÄ±cÄ± yok â†’ login'e yÃ¶nlendiriliyor");
      window.location.href = "login.html";
    } else {
      console.log("GiriÅŸ yapan:", user.email);
      document.body.style.display = "block"; // Paneli gÃ¶rÃ¼nÃ¼r yap
    }
  });

  // Ã‡Ä±kÄ±ÅŸ
  window.logout = function() {
    signOut(auth).then(() => {
      window.location.href = "login.html";
    });
  };
</script>

<!-- Sayfa ilk aÃ§Ä±ldÄ±ÄŸÄ±nda gizli olsun -->
<style>
  body { display: none; }
</style>

<header class="site-header">
  <div class="logo">Editor Paneli</div>
  <nav class="nav">
    <button onclick="logout()" class="btn-secondary">Ã‡Ä±kÄ±ÅŸ Yap</button>
  </nav>
</header>

<main class="section">
  <h2>Kitap Ekle</h2>

  <form id="bookForm" class="contact-form">
    <div class="form-group">
      <label>Kitap AdÄ±</label>
      <input type="text" id="bookTitle" required />
    </div>

    <div class="form-group">
      <label>Arka Kapak YazÄ±sÄ±</label>
      <textarea id="bookDesc" rows="4" required></textarea>
    </div>

    <div class="form-group">
      <label>Kitap Tam Metni</label>
      <textarea id="bookFullText" rows="10"></textarea>
    </div>

    <button type="submit" class="btn-primary">Kaydet</button>
  </form>

  <h2 style="margin-top:2rem;">Mevcut Kitaplar</h2>
  <div id="bookList"></div>
</main>

<script>
  const books = JSON.parse(localStorage.getItem("books") || "[]");

  function renderBooks() {
    const list = document.getElementById("bookList");
    list.innerHTML = "";

    books.forEach((b, i) => {
      const div = document.createElement("div");
      div.className = "book-card";
      div.innerHTML = `
        <h3>${b.title}</h3>
        <p>${b.desc}</p>
        <button class="btn-secondary" onclick="deleteBook(${i})">Sil</button>
      `;
      list.appendChild(div);
    });
  }

  document.getElementById("bookForm").addEventListener("submit", (e) => {
    e.preventDefault();

    books.push({
      title: bookTitle.value,
      desc: bookDesc.value,
      fullText: bookFullText.value
    });

    localStorage.setItem("books", JSON.stringify(books));
    renderBooks();
    e.target.reset();
  });

  function deleteBook(i) {
    books.splice(i, 1);
    localStorage.setItem("books", JSON.stringify(books));
    renderBooks();
  }

  renderBooks();
</script>

</body>
</html>
